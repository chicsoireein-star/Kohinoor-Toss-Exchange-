<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KohiNoor Toss Exchange</title>

<style>
body { font-family:Arial,sans-serif;background:#0b1a2e;color:#fff;margin:0 }
header { background:#1f2e45;padding:20px;text-align:center;font-size:26px;font-weight:bold;color:#ffa500 }
.container { max-width:820px;margin:30px auto;background:#162b40;padding:25px;border-radius:10px }
input,button,select { padding:10px;margin-top:10px;font-size:16px;border:none;border-radius:5px;width:100% }
input,select { background:#fff;color:#000 }
button { background:#ffa500;color:#000;cursor:pointer }
.match { background:#203a5c;padding:15px;margin-top:20px;border-radius:8px }
.match h3 { color:#ffa500;margin:0 0 8px }
.bet-btns { display:flex;gap:10px }
.bet-btns button { flex:1;font-weight:bold }
.disabled { background:#555!important;cursor:not-allowed }
.balance { color:#4fffa0;font-size:18px;font-weight:bold }
.logout { background:#ff4d4d;margin-top:20px }
.result { margin-top:10px;font-weight:bold }
#adminPanel,#userPanel { display:none }
table { width:100%;border-collapse:collapse;margin-top:20px }
th,td { border:1px solid #555;padding:8px;text-align:center }
th { background:#ffa500;color:#000 }
.row { display:flex;gap:10px }
.small { width:48% }
</style>
</head>

<body>
<header>KohiNoor Toss Exchange</header>

<div class="container" id="loginContainer">
  <h2>Login</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <div class="row">
    <button id="loginBtn" class="small">Login</button>
    <button id="resetData" class="small">Reset Data</button>
  </div>
</div>

<div class="container" id="userPanel">
  <h2>Welcome <span id="userNameDisplay"></span></h2>
  <div class="balance">Balance ₹<span id="userBalance"></span></div>
  <div id="matchesContainer"></div>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="container" id="adminPanel">
  <h2>Admin Panel</h2>
  <div id="adminMatches"></div>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<script>
/* ===== CONFIG ===== */
const ODDS = 1.98;
const MIN_BET = 10;
const MAX_BET = 10000;
const CUTOFF_MINUTES = 40; // ✅ 40 minutes before toss

/* ===== USERS ===== */
const defaultUsers = [
  {username:"admin",password:"admin123",balance:0,role:"admin"},
  {username:"kaptaan",password:"cyrus344",balance:90000,role:"user"}
];

/* ===== MATCHES (FIXED) ===== */
const matches = [
  {
    id:"m1",
    teams:["Australia","England"],
    tossTime:"2025-12-17T05:00:00+05:30"
  },
  {
    id:"m2",
    teams:["Sydney Sixers","Adelaide Strikers"],
    tossTime:"2025-12-17T13:45:00+05:30"
  }
];

/* ===== STATE ===== */
let users = JSON.parse(localStorage.getItem("users")) || defaultUsers;
let bets = JSON.parse(localStorage.getItem("bets")) || {};
let currentUser = null;

/* ===== LOGIN ===== */
loginBtn.onclick = () => {
  const u = username.value.trim();
  const p = password.value.trim();
  const user = users.find(x=>x.username===u && x.password===p);
  if(!user){ alert("Invalid login"); return; }
  currentUser = user;
  bets[u] ||= [];
  save(); showPanel();
};

/* ===== LOGOUT ===== */
function logout(){
  currentUser=null;
  showPanel();
}

/* ===== SAVE ===== */
function save(){
  localStorage.setItem("users",JSON.stringify(users));
  localStorage.setItem("bets",JSON.stringify(bets));
}

/* ===== UI ===== */
function showPanel(){
  loginContainer.style.display = currentUser ? "none":"block";
  userPanel.style.display = currentUser && currentUser.role==="user"?"block":"none";
  adminPanel.style.display = currentUser && currentUser.role==="admin"?"block":"none";
  if(currentUser){
    userNameDisplay.textContent=currentUser.username;
    userBalance.textContent=currentUser.balance.toFixed(2);
    renderMatches();
    renderAdmin();
  }
}

/* ===== MATCH RENDER ===== */
function renderMatches(){
  matchesContainer.innerHTML="";
  const now=new Date();
  matches.forEach(m=>{
    const toss=new Date(m.tossTime);
    const cutoff=new Date(toss.getTime()-CUTOFF_MINUTES*60000);
    const open=now<cutoff;

    const div=document.createElement("div");
    div.className="match";
    div.innerHTML=`
      <h3>${m.teams[0]} vs ${m.teams[1]}</h3>
      <div>${open?"OPEN":"<span style='color:red'>CLOSED</span>"}</div>
      <input id="amt-${m.id}" type="number" placeholder="Amount" ${!open?"disabled":""}>
      <div class="bet-btns">
        <button ${!open?"disabled class='disabled'":""} onclick="bet('${m.id}','${m.teams[0]}')">${m.teams[0]}</button>
        <button ${!open?"disabled class='disabled'":""} onclick="bet('${m.id}','${m.teams[1]}')">${m.teams[1]}</button>
      </div>
    `;
    matchesContainer.appendChild(div);
  });
}

/* ===== BET ===== */
function bet(mid,team){
  const amt=Number(document.getElementById("amt-"+mid).value);
  if(!amt||amt<MIN_BET||amt>MAX_BET) return alert("Invalid amount");
  if(amt>currentUser.balance) return alert("Low balance");
  currentUser.balance-=amt;
  bets[currentUser.username].push({mid,team,amt,odds:ODDS});
  save(); showPanel();
  alert("Bet placed");
}

/* ===== ADMIN ===== */
function renderAdmin(){
  if(!currentUser||currentUser.role!=="admin") return;
  adminMatches.innerHTML="";
  matches.forEach(m=>{
    adminMatches.innerHTML+=`
      <div class="match">
        <h3>${m.teams[0]} vs ${m.teams[1]}</h3>
      </div>`;
  });
}

/* ===== RESET ===== */
resetData.onclick=()=>{
  localStorage.clear();
  location.reload();
}

showPanel();
</script>
</body>
</html>
